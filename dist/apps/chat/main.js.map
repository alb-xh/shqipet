{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///external commonjs \"tslib\"","webpack:///external commonjs \"@nestjs/core\"","webpack:///./src/app/app.module.ts","webpack:///external commonjs \"@nestjs/common\"","webpack:///./src/app/users.map.ts","webpack:///./src/app/chat.gateway.ts","webpack:///external commonjs \"@nestjs/websockets\"","webpack:///external commonjs \"socket.io\"","webpack:///./src/app/events.ts","webpack:///webpack/bootstrap","webpack:///./src/main.ts"],"sourcesContent":["module.exports = require(\"tslib\");","module.exports = require(\"@nestjs/core\");","import { Module } from '@nestjs/common';\nimport { UsersMap } from './users.map';\nimport { ChatGateway } from './chat.gateway';\n\n@Module({\n  providers: [ UsersMap, ChatGateway ],\n})\nexport class AppModule {}\n","module.exports = require(\"@nestjs/common\");","import { ForbiddenException, Injectable } from \"@nestjs/common\";\nimport { GeoInfo } from \"@shqipet/geo\";\n\nexport type UserData = { geo: GeoInfo };\nexport type IUsersMap = Record<string, UserData>;\n\nInjectable()\nexport class UsersMap {\n  private readonly usersMap: IUsersMap = {};\n\n  exists (id: string): boolean {\n    return !!this.usersMap[id];\n  }\n\n  get (id: string): UserData {\n    if (!this.exists(id)) {\n      throw new ForbiddenException();\n    }\n\n    return { ...this.usersMap[id] };\n  }\n\n  getAll (): IUsersMap {\n    return { ...this.usersMap };\n  }\n\n  add (id: string, data: UserData): this {\n    if (this.exists(id)) {\n      throw new ForbiddenException();\n    }\n\n    this.usersMap[id] = data;\n\n    return this;\n  }\n\n  remove (id: string): this {\n    if (!this.exists(id)) {\n      throw new ForbiddenException();\n    }\n\n    return this;\n  }\n}\n","import {\n  WebSocketGateway,\n  WebSocketServer,\n  OnGatewayConnection,\n  OnGatewayDisconnect,\n  SubscribeMessage,\n} from '@nestjs/websockets';\nimport { GeoInfo } from '@shqipet/geo';\nimport { Server, Socket } from 'socket.io';\n\nimport { Event } from './events';\nimport { UserData, UsersMap } from './users.map';\n\n@WebSocketGateway({ path: '/chat', cors: { origin: '*' } })\nexport class ChatGateway {\n  @WebSocketServer() server: Server;\n\n  constructor (private readonly users: UsersMap) {}\n\n  @SubscribeMessage(Event.AddUser)\n  async addUser (client: Socket, data: UserData) {\n    console.log(data);\n    console.log(client);\n    this.server.emit(\n      Event.UpdateUsers,\n      this.users.add(client.id, data)\n        .getAll()\n    );\n  }\n\n  @SubscribeMessage(Event.RemoveUser)\n  async removeUser(client: Socket) {\n    this.server.emit(\n      Event.UpdateUsers,\n      this.users.remove(client.id)\n        .getAll()\n    );\n  }\n}","module.exports = require(\"@nestjs/websockets\");","module.exports = require(\"socket.io\");","export enum Event {\n  AddUser = 'add_user',\n  RemoveUser = 'remove_user',\n  UpdateUsers = 'update_users',\n  NewMessage = 'new_message',\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app/app.module';\nimport { Logger } from '@nestjs/common';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  await app.listen(5000);\n\n  Logger.log(`ðŸš€ Application is running on: http://localhost:5000/chat`);\n}\n\nbootstrap();"],"names":[],"sourceRoot":""}