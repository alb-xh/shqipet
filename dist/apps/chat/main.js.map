{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///external commonjs \"tslib\"","webpack:///external commonjs \"@nestjs/core\"","webpack:///./src/app/app.module.ts","webpack:///external commonjs \"@nestjs/common\"","webpack:///../../libs/config/src/index.ts","webpack:///../../libs/config/src/lib/config.module.ts","webpack:///external commonjs \"@nestjs/config\"","webpack:///../../libs/geo/src/index.ts","webpack:///../../libs/geo/src/lib/geo.module.ts","webpack:///../../libs/geo/src/lib/geo.service.ts","webpack:///external node-commonjs \"path\"","webpack:///external node-commonjs \"fs\"","webpack:///external commonjs \"@maxmind/geoip2-node\"","webpack:///./src/app/geo.map.ts","webpack:///./src/app/chat.gateway.ts","webpack:///external commonjs \"cookie\"","webpack:///external commonjs \"@nestjs/websockets\"","webpack:///../../libs/common/src/index.ts","webpack:///../../libs/common/src/lib/types.ts","webpack:///../../libs/common/src/lib/helpers.ts","webpack:///external commonjs \"short-unique-id\"","webpack:///external commonjs \"socket.io\"","webpack:///../../libs/auth/src/index.ts","webpack:///../../libs/auth/src/lib/auth.module.ts","webpack:///../../libs/auth/src/lib/google-auth.service.ts","webpack:///external commonjs \"google-auth-library\"","webpack:///./src/app/message-formatter.ts","webpack:///external commonjs \"dompurify\"","webpack:///external commonjs \"jsdom\"","webpack:///external commonjs \"marked\"","webpack:///./src/app/room.map.ts","webpack:///webpack/bootstrap","webpack:///./src/main.ts"],"sourcesContent":["module.exports = require(\"tslib\");","module.exports = require(\"@nestjs/core\");","import { Module } from '@nestjs/common';\nimport { ConfigModule } from '@shqipet/config';\nimport { GeoModule } from '@shqipet/geo';\n\nimport { GeoMap } from './geo.map';\nimport { ChatGateway } from './chat.gateway';\nimport { MessageFormatter } from './message-formatter';\nimport { AuthModule } from '@shqipet/auth';\nimport { RoomMap } from './room.map';\n\n@Module({\n  imports: [ ConfigModule, AuthModule, GeoModule ],\n  providers: [ GeoMap, RoomMap, MessageFormatter, ChatGateway ],\n})\nexport class AppModule {}\n","module.exports = require(\"@nestjs/common\");","export * from './lib/config.module';\n","import { Module } from '@nestjs/common';\nimport { ConfigService, ConfigModule as NestConfigModule } from '@nestjs/config';\n\nconst envFilePath = process.env['NODE' + '_ENV'] === 'production' ? '.prod.env' : '.dev.env';\n\n@Module({\n  imports: [ NestConfigModule.forRoot({ isGlobal: true, envFilePath  }) ],\n  providers: [ConfigService],\n  exports: [ConfigService],\n})\nexport class ConfigModule {}\n","module.exports = require(\"@nestjs/config\");","export * from './lib/geo.module';\nexport * from './lib/geo.service';\n","import { Module } from '@nestjs/common';\nimport { GeoService } from './geo.service';\n\n@Module({\n  providers: [ GeoService ],\n  exports: [ GeoService ],\n})\nexport class GeoModule {}\n","import { join } from 'path';\nimport { readFileSync } from 'fs';\nimport { GeoInfo } from '@shqipet/common';\nimport { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { Reader as ReaderNode, ReaderModel } from '@maxmind/geoip2-node';\n\n@Injectable()\nexport class GeoService {\n  private reader: ReaderModel;\n\n  constructor (configService: ConfigService) {\n    const path = configService.getOrThrow('GEO_DB_PATH');\n    const fullPath = join(process.cwd(), path);\n    const file = readFileSync(fullPath);\n\n    this.reader = ReaderNode.openBuffer(file);\n  }\n\n  getInfo (ip: string): GeoInfo {\n    const {\n      country,\n      city,\n      location,\n    } = this.reader.city(ip);\n\n    return {\n      name: country?.names?.en,\n      code: country?.isoCode,\n      city: city?.names?.en,\n      lat: location?.latitude,\n      lng: location?.longitude,\n    }\n  }\n}\n","module.exports = require(\"path\");","module.exports = require(\"fs\");","module.exports = require(\"@maxmind/geoip2-node\");","import { ForbiddenException, Injectable } from \"@nestjs/common\";\nimport { GeoInfo, GeoMap as IGeoMap } from \"@shqipet/common\";\n\nInjectable()\nexport class GeoMap {\n  private readonly geoMap: IGeoMap = {};\n\n  exists (id: string): boolean {\n    return !!this.geoMap[id];\n  }\n\n  get (id: string): GeoInfo {\n    if (!this.exists(id)) {\n      throw new ForbiddenException();\n    }\n\n    return { ...this.geoMap[id] };\n  }\n\n  getAll (): IGeoMap {\n    return { ...this.geoMap };\n  }\n\n  add (id: string, data: GeoInfo): this {\n    this.geoMap[id] = data;\n    return this;\n  }\n\n  remove (id: string): this {\n    if (!this.exists(id)) {\n      throw new ForbiddenException();\n    }\n\n    delete this.geoMap[id];\n\n    return this;\n  }\n}\n","import cookie from 'cookie';\nimport {\n  WebSocketGateway,\n  WebSocketServer,\n  OnGatewayConnection,\n  OnGatewayDisconnect,\n  SubscribeMessage,\n  MessageBody,\n  ConnectedSocket,\n} from '@nestjs/websockets';\nimport { GeoService } from '@shqipet/geo';\nimport { ChatEvent, CreateRoomMessage, JoinRoomMessage, Message, SendToRoomMessage } from '@shqipet/common';\nimport { ConfigService } from '@nestjs/config';\nimport { Server, Socket } from 'socket.io';\nimport { GoogleAuthService } from '@shqipet/auth';\n\nimport { GeoMap } from './geo.map';\nimport { MessageFormatter } from './message-formatter';\nimport { RoomMap } from './room.map';\n\nconst cors: Record<string, unknown> = {\n  credentials: true,\n  origin: '*',\n};\n\n@WebSocketGateway({ path: '/chat', cors })\nexport class ChatGateway implements OnGatewayConnection, OnGatewayDisconnect {\n  @WebSocketServer() server: Server;\n\n  private readonly verifiedClients = new Set<string>();\n\n  private readonly cookieName: string;\n  private readonly domain: string;\n  private readonly devIp = '91.82.156.27';\n\n  constructor (\n    private readonly googleAuthService: GoogleAuthService,\n    private readonly geoMap: GeoMap,\n    private readonly roomMap: RoomMap,\n    private readonly geoService: GeoService,\n    private readonly messageFormatter: MessageFormatter,\n    configService: ConfigService,\n  ) {\n    const cookieName = configService.getOrThrow('COOKIE');\n    const domain = configService.getOrThrow('DOMAIN');\n\n    this.cookieName = cookieName;\n    this.domain = domain;\n    cors.origin = new RegExp(domain);\n  }\n\n  private async isLoggedIn (client: Socket): Promise<boolean> {\n    if (this.verifiedClients.has(client.id)) {\n      return true;\n    }\n\n    const token = cookie.parse(client.handshake.headers.cookie)[this.cookieName];\n    if (token && await this.googleAuthService.isValid(token)) {\n      this.verifiedClients.add(client.id);\n\n      return true;\n    }\n\n    return false;\n  }\n\n  private getIp (client: Socket): string {\n    return this.domain !== 'localhost'\n      ? client.handshake.headers['x-real-ip'] as string || client.handshake.address\n      : this.devIp;\n  }\n\n  async handleConnection (client: Socket) {\n    const ip = this.getIp(client);\n    if (!ip) {\n      return;\n    }\n\n    const geoInfo = this.geoService.getInfo(ip);\n\n    this.server.emit(\n      ChatEvent.UpdateGeoMap,\n      this.geoMap.add(client.id, geoInfo)\n        .getAll()\n    );\n}\n\n  async handleDisconnect(client: Socket) {\n    if (!this.geoMap.exists(client.id)) {\n      return;\n    }\n\n    this.server.emit(\n      ChatEvent.UpdateGeoMap,\n      this.geoMap.remove(client.id)\n        .getAll()\n    );\n\n    for (const roomId in this.roomMap.getAll()) {\n      const room = this.roomMap.get(roomId);\n\n      for (const memberId in room.members) {\n        if (memberId !== client.id) {\n          continue;\n        }\n\n        room.removeMember(memberId);\n\n        this.server.to(roomId)\n          .emit(ChatEvent.UpdateRoom, this.roomMap.getInfo(room));\n      }\n    }\n  }\n\n  @SubscribeMessage(ChatEvent.CreateMessage)\n  async handleCreateMessage(\n    @MessageBody() { user, text }: Message,\n    @ConnectedSocket() client: Socket,\n  ) {\n    if (!await this.isLoggedIn(client)) {\n      return;\n    }\n\n    const formattedText = this.messageFormatter.format(text);\n    if (!formattedText) {\n      return;\n    }\n\n    this.server.emit(ChatEvent.BroadcastMessage, { user, text: formattedText });\n  }\n\n  @SubscribeMessage(ChatEvent.CreateRoom)\n  async handleCreateRoom(\n    @MessageBody() { id, size, meta }: CreateRoomMessage,\n    @ConnectedSocket() client: Socket,\n  ) {\n    if (!await this.isLoggedIn(client)) {\n      return;\n    }\n\n    this.roomMap.set({ id, size, meta });\n  }\n\n  @SubscribeMessage(ChatEvent.JoinRoom)\n  async handleJoinRoom(\n    @MessageBody() { id, user }: JoinRoomMessage,\n    @ConnectedSocket() client: Socket\n  ) {\n    if (!await this.isLoggedIn(client)) {\n      return;\n    }\n\n    const room = this.roomMap.get(id);\n    if (room.memberExists(client.id)) {\n      return;\n    }\n\n    room.setMember({ id: client.id, user });\n\n    for (const id in room.members) {\n      this.server.to(id)\n        .emit(ChatEvent.UpdateRoom, this.roomMap.getInfo(room));\n    }\n  }\n\n  @SubscribeMessage(ChatEvent.SendToRoom)\n  async handleSendToRoom(\n    @MessageBody() { id, state }: SendToRoomMessage,\n    @ConnectedSocket() client: Socket,\n  ) {\n    if (!await this.isLoggedIn(client)) {\n      return;\n    }\n\n    const room = this.roomMap.get(id);\n    if (!room.memberExists(client.id)) {\n      return;\n    }\n\n    for (const id in room.members) {\n      this.server.to(id)\n        .emit(ChatEvent.BroadcastToRoom, state);\n    }\n  }\n}","module.exports = require(\"cookie\");","module.exports = require(\"@nestjs/websockets\");","export * from './lib/types';\nexport * from './lib/helpers';\n","export enum ChatEvent {\n  UpdateGeoMap = 'update_geo_map',\n  CreateMessage = 'create_message',\n  BroadcastMessage = 'broadcast_message',\n  CreateRoom = 'create_room',\n  CreatedRoom = 'created_room',\n  JoinRoom = 'join_room',\n  UpdateRoom = 'update_room',\n  SendToRoom = 'send_to_room',\n  BroadcastToRoom = 'broadcast_to_room',\n};\n\nexport interface GeoInfo {\n  name?: string,\n  code?: string,\n  city?: string,\n  lat?: number,\n  lng?: number,\n};\n\nexport type GeoMap = Record<string, GeoInfo>;\n\nexport interface UserInfo {\n  avatar?: string,\n  name: string,\n}\n\nexport interface RoomInfo {\n  id: string,\n  size: number,\n  members: UserInfo[],\n  meta?: Record<string, any>,\n}\n\nexport interface Message {\n  user: UserInfo,\n  text: string,\n};\n\nexport interface CreateRoomMessage {\n  id: string,\n  size: number,\n  meta?: Record<string, any>,\n}\n\nexport interface JoinRoomMessage {\n  id: string,\n  user: UserInfo,\n}\n\nexport interface SendToRoomMessage {\n  id: string,\n  state: Record<string, any>,\n};","import shortUniqId from 'short-unique-id';\n\nexport const randomId = (length = 10) =>  new shortUniqId({ length }).randomUUID();\n\nexport const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n","module.exports = require(\"short-unique-id\");","module.exports = require(\"socket.io\");","export * from './lib/auth.module';\nexport * from './lib/google-auth.service';\n","import { Module } from '@nestjs/common';\nimport { ConfigModule } from '@shqipet/config';\nimport { GoogleAuthService } from './google-auth.service';\n\n@Module({\n  imports: [ConfigModule],\n  providers: [GoogleAuthService],\n  exports: [GoogleAuthService],\n})\nexport class AuthModule {}\n","\nimport { ForbiddenException, Injectable } from \"@nestjs/common\";\nimport { ConfigService } from \"@nestjs/config\";\nimport { UserInfo } from \"@shqipet/common\";\nimport { LoginTicket, OAuth2Client } from 'google-auth-library';\n\n@Injectable()\nexport class GoogleAuthService {\n  private readonly clientId: string;\n  private readonly oAuthClient: OAuth2Client;\n\n  constructor (configService: ConfigService) {\n    const clientId = configService.getOrThrow('GOOGLE_CLIENT_ID');\n\n    this.clientId = clientId;\n    this.oAuthClient = new OAuth2Client(clientId);\n  }\n\n  private async getTicket (token: string): Promise<LoginTicket> {\n    return this.oAuthClient.verifyIdToken({\n      idToken: token,\n      audience: this.clientId\n    });\n  }\n\n  async isValid (token: string): Promise<boolean> {\n    try {\n      await this.getTicket(token);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async getUser (token: string): Promise<UserInfo> {\n    const ticket = await this.getTicket(token);\n\n    const { picture, name, given_name, family_name } = ticket.getPayload();\n\n    const userName = name || [ given_name, family_name ].join(' ');\n    if (!userName) {\n      throw new ForbiddenException('User must have a name!');\n    }\n\n    return {\n      name: userName,\n      avatar: picture,\n    };\n  }\n}\n","module.exports = require(\"google-auth-library\");","import DOMPurify from 'dompurify';\nimport { JSDOM } from 'jsdom';\nimport { marked } from 'marked';\n\nconst window = new JSDOM('').window;\nconst { sanitize } = DOMPurify(window);\n\nexport class MessageFormatter {\n  format (text: string): string {\n    return marked.parseInline(sanitize(text), {\n      headerIds: false,\n      mangle: false,\n      highlight: null,\n      langPrefix: null,\n    });\n  }\n}\n","module.exports = require(\"dompurify\");","module.exports = require(\"jsdom\");","module.exports = require(\"marked\");","import { ForbiddenException, Injectable } from \"@nestjs/common\";\nimport { RoomInfo, UserInfo } from \"@shqipet/common\";\n\ntype Member = {\n  id: string,\n  user: UserInfo,\n};\n\ntype MemberMap = Record<string, Member>;\n\nclass Room {\n  readonly createdAt = Date.now();\n\n  constructor (\n    readonly id: string,\n    readonly size: number,\n    readonly members: MemberMap,\n    readonly meta: Record<string, any> = {},\n  ) {}\n\n  memberExists (id: string): boolean {\n    return !!this.members[id];\n  }\n\n  getMember (id: string): Member {\n    if (!this.memberExists(id)) {\n      throw new ForbiddenException();\n    }\n\n    return this.members[id];\n  }\n\n  setMember (member: Member): this {\n    if (this.memberExists(member.id)) {\n      throw new ForbiddenException();\n    }\n\n    if (Object.keys(this.members).length >= this.size) {\n      throw new ForbiddenException();\n    }\n\n    this.members[member.id] = member;\n\n    return this;\n  }\n\n  removeMember (id: string): this {\n    const member = this.getMember(id);\n    delete this.members[member.id];\n\n    return this;\n  }\n}\n\ntype IRoomMap = Record<string, Room>;\n\nInjectable()\nexport class RoomMap {\n  private readonly roomMap: IRoomMap  = {};\n  private readonly ttl = 1000 * 60 * 10;\n  private readonly interval = setInterval(() => this.clearStaleRooms(), this.ttl);\n\n  private clearStaleRooms (): void {\n    const now = Date.now();\n\n    for (const id in this.roomMap) {\n      const { createdAt } = this.roomMap[id];\n\n      if (now > createdAt + this.ttl) {\n        this.remove(id);\n      }\n    }\n  }\n\n  exists (id: string): boolean {\n    return !!this.roomMap[id];\n  }\n\n  get (id: string): Room {\n    if (!this.exists(id)) {\n      throw new ForbiddenException();\n    }\n\n    return this.roomMap[id];\n  }\n\n  getAll (): IRoomMap {\n    return this.roomMap;\n  }\n\n  set (room: Omit<RoomInfo, 'members' | 'createdAt'>): this {\n    const { id, size, meta } = room;\n\n    if (this.exists(id)) {\n      throw new ForbiddenException();\n    }\n\n    this.roomMap[id] = new Room(id, size, {}, meta);\n\n    return this;\n  }\n\n  remove (id: string): this {\n    const room = this.get(id);\n\n    delete this.roomMap[room.id];\n\n    return this;\n  }\n\n  getInfo (room: Room): RoomInfo {\n    const { id, size, members, meta } = room;\n\n    return {\n      id,\n      size,\n      members: Object.values(members).map(({ user }) => user),\n      meta,\n    };\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app/app.module';\nimport { Logger } from '@nestjs/common';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  await app.listen(5000);\n\n  Logger.log(`🚀 Application is running on: http://localhost:5000/chat`);\n}\n\nbootstrap();"],"names":[],"sourceRoot":""}