{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///external commonjs \"tslib\"","webpack:///external commonjs \"cookie-parser\"","webpack:///external commonjs \"helmet\"","webpack:///external commonjs \"@nestjs/common\"","webpack:///external commonjs \"@nestjs/core\"","webpack:///external commonjs \"@nestjs/config\"","webpack:///../../libs/common/src/index.ts","webpack:///../../libs/common/src/lib/types.ts","webpack:///../../libs/common/src/lib/helpers.ts","webpack:///external commonjs \"short-unique-id\"","webpack:///external commonjs \"@nestjs/swagger\"","webpack:///./src/app/app.module.ts","webpack:///../../libs/config/src/index.ts","webpack:///../../libs/config/src/lib/config.module.ts","webpack:///../../libs/db/src/index.ts","webpack:///../../libs/db/src/lib/db.module.ts","webpack:///external commonjs \"@nestjs/typeorm\"","webpack:///external commonjs \"lodash\"","webpack:///../../libs/db/src/lib/dataSource.ts","webpack:///external commonjs \"dotenv\"","webpack:///external commonjs \"typeorm\"","webpack:///../../libs/db/src/lib/entities/index.ts","webpack:///../../libs/db/src/lib/entities/user.entity.ts","webpack:///external commonjs \"@nestjs/throttler\"","webpack:///external commonjs \"@nestjs/jwt\"","webpack:///./src/app/controllers/index.ts","webpack:///./src/app/controllers/users.controller.ts","webpack:///external commonjs \"express\"","webpack:///./src/app/dtos/index.ts","webpack:///./src/app/dtos/create-user.dto.ts","webpack:///external commonjs \"class-validator\"","webpack:///./src/app/dtos/user-sign-in.dto.ts","webpack:///./src/app/dtos/change-password.dto.ts","webpack:///./src/app/decorators/index.ts","webpack:///./src/app/decorators/use-throttle.decorator.ts","webpack:///./src/app/decorators/use-auth.decorator.ts","webpack:///./src/app/guards/index.ts","webpack:///./src/app/guards/auth.guard.ts","webpack:///./src/app/services/index.ts","webpack:///./src/app/services/auth.service.ts","webpack:///./src/app/services/users.service.ts","webpack:///./src/app/components/index.ts","webpack:///./src/app/components/password-hasher.component.ts","webpack:///external commonjs \"bcrypt\"","webpack:///./src/app/decorators/get-user.decorator.ts","webpack:///./src/app/controllers/me.controller.ts","webpack:///webpack/bootstrap","webpack:///./src/main.ts"],"sourcesContent":["module.exports = require(\"tslib\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"helmet\");","module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/core\");","module.exports = require(\"@nestjs/config\");","export * from './lib/types';\nexport * from './lib/helpers';\n","export enum WsEvent {\n  UpdateGeoMap = 'update_geo_map',\n  CreateMessage = 'create_message',\n  BroadcastMessage = 'broadcast_message',\n  CreateRoom = 'create_room',\n  CreatedRoom = 'created_room',\n  JoinRoom = 'join_room',\n  UpdateRoom = 'update_room',\n  SendToRoom = 'send_to_room',\n  BroadcastToRoom = 'broadcast_to_room',\n};\n\nexport interface GeoInfo {\n  name?: string,\n  code?: string,\n  city?: string,\n  lat?: number,\n  lng?: number,\n};\n\nexport interface UserInfo {\n  id: string,\n  avatar?: string,\n  name: string,\n}\n\nexport interface RoomInfo {\n  id: string,\n  title: string,\n  size?: number,\n  members: UserInfo[],\n}\n\nexport interface Message {\n  user: UserInfo,\n  text: string,\n};\n\nexport interface CreateRoomMessage {\n  id: string,\n  title: string,\n  size?: number,\n}\n\nexport interface JoinRoomMessage {\n  id: string,\n  user: UserInfo,\n}\n\nexport interface SendToRoomMessage {\n  id: string,\n  state: Record<string, any>,\n};\n\nexport interface PublicUser {\n  id: number,\n  username: string,\n  firstName: string,\n  lastName: string,\n  profilePictureUrl?: string,\n  bio?: string,\n}\n\nexport interface CreateUserResponse extends PublicUser {\n  resetPasswordCode: string,\n}\n\nexport interface CreateUser {\n  username: string,\n  firstName: string,\n  lastName: string,\n  password: string,\n}\n\nexport interface UserSignIn {\n  password: string,\n}\n\nexport interface ChangePassword {\n  oldPassword: string,\n  newPassword: string,\n}\n","import shortUniqId from 'short-unique-id';\n\nexport const randomId = (length = 10) =>  new shortUniqId({ length }).randomUUID();\n\nexport const delay = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n\nexport const isProduction = () => process.env['NODE' + '_ENV'] === 'production';\n\nexport const getEnvFile = () => isProduction() ? '.prod.env' : '.dev.env';\n","module.exports = require(\"short-unique-id\");","module.exports = require(\"@nestjs/swagger\");","import { Module } from '@nestjs/common';\nimport { ConfigModule } from '@shqipet/config';\nimport { DbModule } from '@shqipet/db';\nimport { ThrottlerModule } from '@nestjs/throttler';\nimport { JwtModule } from '@nestjs/jwt';\n\nimport { MeController, UsersController } from './controllers';\nimport { UsersService, AuthService } from './services';\nimport { PasswordHasher } from './components';\nimport { ConfigService } from '@nestjs/config';\n\n@Module({\n  imports: [\n    ConfigModule,\n    DbModule,\n    ThrottlerModule.forRoot([{\n      ttl: 60000,\n      limit: 100,\n    }]),\n    JwtModule.registerAsync({\n      useFactory: (configService: ConfigService) => ({\n        secret: configService.getOrThrow('AUTH_TOKEN_SECRET'),\n        signOptions: { expiresIn: configService.getOrThrow('AUTH_TOKEN_EXPIRES_IN') },\n      }),\n      inject: [ConfigService],\n    }),\n  ],\n  providers: [\n    UsersService,\n    PasswordHasher,\n    AuthService,\n  ],\n  controllers: [\n    MeController,\n    UsersController,\n  ],\n})\nexport class AppModule {}\n","export * from './lib/config.module';\n","import { Module } from '@nestjs/common';\nimport { ConfigService, ConfigModule as NestConfigModule } from '@nestjs/config';\nimport { getEnvFile } from '@shqipet/common';\n\n@Module({\n  imports: [ NestConfigModule.forRoot({ isGlobal: true, envFilePath: getEnvFile()  }) ],\n  providers: [ConfigService],\n  exports: [ConfigService],\n})\nexport class ConfigModule {}\n","export * from './lib/db.module';\nexport * from './lib/entities';\n","import { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { omit } from 'lodash';\n\nimport { options } from './dataSource';\nimport * as entitiesObj from './entities';\n\nconst entities = Object.values(entitiesObj)\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      ...omit(options, ['entities', 'migrations']),\n      entities,\n    }),\n    TypeOrmModule.forFeature(entities),\n  ],\n  exports: [ TypeOrmModule ]\n})\nexport class DbModule {}\n","module.exports = require(\"@nestjs/typeorm\");","module.exports = require(\"lodash\");","import * as dotenv from 'dotenv';\nimport { DataSource } from 'typeorm';\n\nconst isProduction = process.env.NODE_ENV === 'production';\nconst envFile = isProduction ? '.prod.env' : '.dev.env';\nconst entitiesPath = isProduction ? 'dist/libs/db/src/lib/entities/*.entity.js' : 'libs/db/src/lib/entities/*.entity.ts';\nconst migrationsPath = isProduction ? 'dist/libs/db/src/lib/migrations/*.js' : 'libs/db/src/lib/migrations/*.ts';\n\ndotenv.config({ path: envFile });\n\nexport const options = {\n  type: process.env.DB_TYPE as any,\n  host: process.env.DB_HOST,\n  port: parseInt(process.env.DB_PORT as string, 10),\n  username: process.env.DB_USERNAME,\n  password: process.env.DB_PASSWORD,\n  database: process.env.DB_DATABASE,\n  entities: [ entitiesPath ],\n  migrations: [ migrationsPath ],\n  migrationsTableName: \"migrations\",\n  synchronize: false,\n}\n\nexport default new DataSource(options);","module.exports = require(\"dotenv\");","module.exports = require(\"typeorm\");","export * from './user.entity';","import { Column, CreateDateColumn, Entity, Index, PrimaryGeneratedColumn, UpdateDateColumn } from 'typeorm';\n\n@Entity()\nexport class User {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column({ unique: true, length: 32 })\n  @Index({ unique: true })\n  username: string;\n\n  @Column()\n  firstName: string;\n\n  @Column()\n  lastName: string;\n\n  @Column({ nullable: true })\n  profilePictureUrl?: string;\n\n  @Column({ length: 150, nullable: true })\n  bio?: string;\n\n  @Column()\n  password: string;\n\n  @Column()\n  resetPasswordCode: string;\n\n  @Column({ type: 'smallint', default: 0 })\n  resetPasswordAttempts = 0;\n\n  @CreateDateColumn()\n  createdAt: Date;\n\n  @UpdateDateColumn()\n  updateAt: Date;\n}","module.exports = require(\"@nestjs/throttler\");","module.exports = require(\"@nestjs/jwt\");","export * from './users.controller';\nexport * from './me.controller';\n","import { Body, Controller, ForbiddenException, Get, NotFoundException, Param, Post, Res } from \"@nestjs/common\";\nimport { CreateUserResponse, PublicUser } from \"@shqipet/common\";\nimport { Response } from 'express';\n\nimport { CreateUserDto, UserSignInDto } from \"../dtos\";\nimport { UseThrottle } from \"../decorators\";\nimport { AuthService, UsersService } from \"../services\";\n\n@Controller('users')\nexport class UsersController {\n  constructor(\n    private readonly usersService: UsersService,\n    private readonly authService: AuthService,\n  ) {}\n\n  @Post()\n  @UseThrottle(3, 60)\n  async createUser(@Body() createUserDto: CreateUserDto): Promise<CreateUserResponse> {\n    if (await this.usersService.userExists(createUserDto.username)) {\n      throw new ForbiddenException('User already exists');\n    }\n\n    const user = await this.usersService.createUser(createUserDto);\n\n    return {\n      id: user.id,\n      username: user.username,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      profilePictureUrl: user.profilePictureUrl,\n      bio: user.bio,\n      resetPasswordCode: user.resetPasswordCode,\n    };\n  }\n\n\n  @Get(':username')\n  async getUserByUsername(@Param('username') username: string): Promise<PublicUser> {\n    const user = await this.usersService.getPublicUser(username);\n    if (!user) {\n      throw new NotFoundException('User not found');\n    }\n\n    return user;\n  }\n\n  @Post(':username/sign-in')\n  @UseThrottle(3, 60)\n  async signIn(\n    @Param('username') username: string,\n    @Body() body: UserSignInDto,\n    @Res() response: Response,\n  ): Promise<void> {\n    const user = await this.usersService.getUser(username);\n    if (!user) {\n      throw new NotFoundException('User not found');\n    }\n\n    if (!await this.usersService.isUserPasswordValid(user, body.password)) {\n      throw new ForbiddenException('Invalid password');\n    }\n\n    await this.authService.signIn(user, response);\n\n    response\n      .status(204)\n      .send();\n  }\n\n}","module.exports = require(\"express\");","export * from './create-user.dto';\nexport * from './user-sign-in.dto';\nexport * from './change-password.dto';\n","import { IsString, Length } from 'class-validator';\nimport { CreateUser } from \"@shqipet/common\";\nimport { ApiProperty } from '@nestjs/swagger';\n\nexport class CreateUserDto implements CreateUser {\n  @IsString()\n  @Length(4, 50)\n  @ApiProperty()\n  username: string;\n\n  @IsString()\n  @Length(2, 50)\n  @ApiProperty()\n  firstName: string;\n\n  @IsString()\n  @Length(2, 50)\n  @ApiProperty()\n  lastName: string;\n\n  @IsString()\n  @Length(8, 32)\n  @ApiProperty()\n  password: string;\n}\n","module.exports = require(\"class-validator\");","import { IsString, Length } from \"class-validator\";\nimport { ApiProperty } from \"@nestjs/swagger\";\nimport { UserSignIn } from \"@shqipet/common\";\n\nexport class UserSignInDto implements UserSignIn {\n  @IsString()\n  @Length(8, 32)\n  @ApiProperty()\n  password: string;\n}","import { ApiProperty } from \"@nestjs/swagger\";\nimport { ChangePassword } from \"@shqipet/common\";\nimport { IsString, Length } from \"class-validator\";\n\nexport class ChangePasswordDto implements ChangePassword {\n  @IsString()\n  @Length(8, 32)\n  @ApiProperty()\n  oldPassword: string;\n\n  @IsString()\n  @Length(8, 32)\n  @ApiProperty()\n  newPassword: string;\n}\n","export * from './use-throttle.decorator';\nexport * from './use-auth.decorator';\nexport * from './get-user.decorator';\n","\nimport { UseGuards, applyDecorators } from \"@nestjs/common\";\nimport { Throttle, ThrottlerGuard } from \"@nestjs/throttler\";\n\nexport const UseThrottle = (limit: number, ttl: number) => applyDecorators(\n  UseGuards(ThrottlerGuard),\n  Throttle({ default: { limit, ttl: ttl * 1000 } }),\n);","import { UseGuards } from \"@nestjs/common\";\nimport { AuthGuard } from \"../guards\";\n\nexport const UseAuth = () => UseGuards(AuthGuard);","export * from './auth.guard';\n","import {\n  CanActivate,\n  ExecutionContext,\n  Injectable,\n  UnauthorizedException,\n} from '@nestjs/common';\n\nimport { AuthService } from '../services';\n\n@Injectable()\nexport class AuthGuard implements CanActivate {\n  constructor(\n    private readonly authService: AuthService\n  ) {}\n\n  async canActivate(context: ExecutionContext): Promise<boolean> {\n    const request = context.switchToHttp().getRequest();\n\n    const user = await this.authService.getUser(request);\n    if (!user) {\n      throw new UnauthorizedException();\n    }\n\n    request['user'] = user;\n\n    return true;\n  }\n}","export * from './auth.service';\nexport * from './users.service';\n","import { Injectable } from \"@nestjs/common\";\nimport { ConfigService } from \"@nestjs/config\";\nimport { JwtService } from \"@nestjs/jwt\";\nimport { isProduction } from \"@shqipet/common\";\nimport { User } from \"@shqipet/db\";\nimport { Request, Response, CookieOptions } from 'express';\nimport { pick } from \"lodash\";\n\n@Injectable()\nexport class AuthService {\n  private readonly publicUserFields: (keyof User)[] = ['id'];\n  private readonly secret: string;\n  private readonly cookieName: string;\n  private readonly cookieOptions: CookieOptions;\n\n  constructor(\n    private readonly jwtService: JwtService,\n    configService: ConfigService,\n  ) {\n    this.secret = configService.getOrThrow('AUTH_TOKEN_SECRET');\n    this.cookieName = configService.getOrThrow('AUTH_COOKIE_NAME');\n    this.cookieOptions = {\n      httpOnly: true,\n      secure: isProduction(),\n      sameSite: 'strict',\n      domain: configService.getOrThrow('DOMAIN'),\n    };\n  }\n\n  private getToken(request: Request): string | undefined {\n    return request.cookies[this.cookieName];\n  }\n\n  async getUser (tokenOrRequest: string | Request): Promise<Partial<User> | null> {\n    const token = typeof tokenOrRequest === 'object'\n      ? this.getToken(tokenOrRequest)\n      : tokenOrRequest;\n\n    if (!token) {\n      return null;\n    }\n\n    try {\n      const userData = await this.jwtService.verify(token, { secret: this.secret });\n\n      const user = new User();\n      Object.assign(user, userData);\n\n      return user;\n    } catch {\n      return null;\n    }\n  }\n\n  async generateToken (user: User): Promise<string> {\n    return this.jwtService.signAsync(\n      pick(user, this.publicUserFields),\n      { secret: this.secret },\n    );\n  }\n\n  async signIn (user: User, res: Response): Promise<void> {\n    const token = await this.generateToken(user);\n\n    res.cookie(this.cookieName, token, this.cookieOptions);\n  }\n\n  async signOut (res: Response): Promise<void> {\n    res.clearCookie(this.cookieName, this.cookieOptions);\n  }\n}\n","import { Injectable, Optional } from \"@nestjs/common\";\nimport { InjectRepository } from \"@nestjs/typeorm\";\nimport { CreateUser, PublicUser, randomId } from \"@shqipet/common\";\nimport { User } from \"@shqipet/db\";\nimport { Repository } from \"typeorm\";\nimport { PasswordHasher } from \"../components\";\n\n@Injectable()\nexport class UsersService {\n  constructor(\n    @InjectRepository(User)\n    private readonly userRepository: Repository<User>,\n    private readonly passwordHasher: PasswordHasher,\n    @Optional()\n    private readonly generateId = randomId,\n  ) {}\n\n  async userExists (usernameOrId: string | number): Promise<boolean> {\n    return typeof usernameOrId === 'number'\n      ? this.userRepository.exist({ where: { id: usernameOrId } })\n      : this.userRepository.exist({ where: { username: usernameOrId } });\n  }\n\n  async getUser (usernameOrId: string | number): Promise<User> {\n    return typeof usernameOrId === 'number'\n      ? this.userRepository.findOneBy({ id: usernameOrId })\n      : this.userRepository.findOneBy({ username: usernameOrId });\n  }\n\n  async getPublicUser (usernameOrId: string | number): Promise<PublicUser> {\n    const user = await this.getUser(usernameOrId);\n\n    return {\n      id: user.id,\n      username: user.username,\n      firstName: user.firstName,\n      lastName: user.lastName,\n      profilePictureUrl: user.profilePictureUrl,\n      bio: user.bio,\n    };\n  }\n\n  async createUser (userData: CreateUser): Promise<User> {\n    const { password, ...rest } = userData;\n\n    const hashedPassword = await this.passwordHasher.hash(password);\n    const user = this.userRepository.create({\n      ...rest,\n      password: hashedPassword,\n      resetPasswordCode: this.generateId(6),\n      resetPasswordAttempts: 0,\n    });\n\n    await this.userRepository.save(user);\n\n    return user;\n  }\n\n  async deleteUser (usernameOrId: string | number): Promise<void> {\n    const user = await this.getUser(usernameOrId);\n\n    await this.userRepository.delete(user);\n  }\n\n  async isUserPasswordValid (usernameOrIdOrUser: string | number | User, password: string): Promise<boolean> {\n    const user = typeof usernameOrIdOrUser !== 'object'\n      ? await this.getUser(usernameOrIdOrUser)\n      : usernameOrIdOrUser;\n\n    if (!user) {\n      return false;\n    }\n\n    const hashedPassword = await this.passwordHasher.hash(password);\n\n    return user.password === hashedPassword;\n  }\n\n  async updateUserPassword (usernameOrId: string | number, password: string): Promise<void> {\n    const user = await this.getUser(usernameOrId);\n    const hashedPassword = await this.passwordHasher.hash(password);\n\n    user.password = hashedPassword;\n\n    await this.userRepository.save(user);\n  }\n}\n","export * from './password-hasher.component';\n","import { hash } from 'bcrypt';\n\nimport { Injectable, Optional } from \"@nestjs/common\";\nimport { ConfigService } from \"@nestjs/config\";\n\n@Injectable()\nexport class PasswordHasher {\n  private readonly salt: string;\n\n  constructor(\n    configService: ConfigService,\n    @Optional()\n    private readonly hashAlgo = hash,\n  ) {\n    this.salt = configService.getOrThrow('PASSWORD_SALT');\n  }\n\n  hash (password: string): Promise<string> {\n    return this.hashAlgo(password, this.salt);\n  }\n}\n","module.exports = require(\"bcrypt\");","\nimport { createParamDecorator, ExecutionContext } from '@nestjs/common';\n\nexport const GetUser = createParamDecorator(\n  (data: unknown, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    return request.user;\n  },\n);","import { Body, Controller, Delete, ForbiddenException, Get, Patch, Post, Res } from \"@nestjs/common\";\nimport { Response } from 'express';\nimport { User } from \"@shqipet/db\";\nimport { PublicUser } from \"@shqipet/common\";\n\nimport { UseAuth, UseThrottle, GetUser } from \"../decorators\";\nimport { AuthService, UsersService } from \"../services\";\nimport { ChangePasswordDto } from \"../dtos\";\n\n@Controller('me')\n@UseAuth()\nexport class MeController {\n  constructor(\n    private readonly usersService: UsersService,\n    private readonly authService: AuthService,\n  ) {}\n\n  @Get()\n  @UseThrottle(10, 60)\n  async getMe (@GetUser() user: Partial<User>): Promise<PublicUser> {\n    return this.usersService.getPublicUser(user.id);\n  }\n\n  @Delete()\n  @UseThrottle(3, 60)\n  async deleteMe(@GetUser() user: Partial<User>): Promise<void> {\n    await this.usersService.deleteUser(user.id);\n  }\n\n  @Post('sign-out')\n  @UseThrottle(10, 60)\n  async signMeOut(@Res() res: Response): Promise<void> {\n    await this.authService.signOut(res);\n\n    res\n      .status(204)\n      .send();\n  }\n\n  @Patch('update-password')\n  @UseThrottle(1, 60)\n  async updateMyPassword(\n    @GetUser() user: Partial<User>,\n    @Body() body: ChangePasswordDto,\n  ): Promise<void> {\n    if (!await this.usersService.isUserPasswordValid(user.id, body.oldPassword)) {\n      throw new ForbiddenException('Invalid password');\n    }\n\n    await this.usersService.updateUserPassword(user.id, body.newPassword);\n  }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import cookieParser from 'cookie-parser';\nimport helmet from 'helmet';\nimport csurf from 'csurf';\n\nimport { Logger, ValidationPipe } from '@nestjs/common';\nimport { NestFactory } from '@nestjs/core';\nimport { ConfigService } from '@nestjs/config';\nimport { isProduction } from '@shqipet/common';\nimport { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';\n\nimport { AppModule } from './app/app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  const configService = app.get(ConfigService);\n  const port = configService.getOrThrow('PORT');\n  const prefix = configService.getOrThrow('PREFIX');\n  const origin = configService.getOrThrow('DOMAIN');\n\n  app.enableCors({ credentials: true, origin: new RegExp(origin) });\n  app.use(cookieParser());\n  app.use(helmet());\n  // app.use(csurf()); // TODO: investigate in future\n\n  app.setGlobalPrefix(prefix);\n  app.useGlobalPipes(new ValidationPipe())\n\n  if (!isProduction()) {\n    const config = new DocumentBuilder()\n    .setTitle('Shqipet')\n    .setDescription(`The shqipet API description`)\n    .setVersion('1.0')\n    .addTag('shqipet')\n    .build();\n\n    const document = SwaggerModule.createDocument(app, config);\n    SwaggerModule.setup(prefix, app, document);\n  }\n\n  await app.listen(port);\n\n  Logger.log(`🚀 Application is running on: http://localhost:${port}/${prefix}`);\n}\n\nbootstrap();\n"],"names":[],"sourceRoot":""}